@{

    ViewData["Title"] = "مدیریت دسته بندی ها - پنل مدیریتی ایمن فروش";

    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<!-- item template -->
<script type="text/x-template" id="item-template">
  <li>
    <div
      :class="{bold: isFolder}">
      <span style="cursor: pointer;" v-on:click="toggle" v-if="isFolder">[{{open ? '-' : '+'}}]</span>
      {{model.text}}

      <span class="action">
        <a href="#" class="text-primary" v-on:click="edit(model)" style="margin-right:20px">ویرایش | </a>
        <a href="#" class="text-warning">اضافه نمودن زیر دسته | </a>
        <a href="#" class="text-success">مدیریت متادیتاها | </a>
        <a href="#" class="text-danger">حذف</a>
      </span>

    </div>
    <ul v-show="open" v-if="isFolder">
      <item
        class="item"
        v-for="model in model.children"
        :model="model">
      </item>
    </ul>
  </li>
</script>


<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/admin">پنل مدیریتی</a></li>
        <li class="breadcrumb-item">مدیریت دسته بندی ها</li>
    </ol>
</nav>

<div class="panel panel-primary">
    <div class="panel-heading">مدیریت دسته بندی ها</div>
    <div class="panel-body">
        <div class="row">
            <div class="col-md-12 col-xs-12">
                <ul id="app" class="tree-admin">
                    <item class="item" :model="treeData">
                    </item>
                </ul>
            </div>            
        </div>
    </div>
</div>

<script>
    Vue.component('item', {
        template: '#item-template',
        props: {
            model: Object
        },
        data: function () {
            return {
                open: false
            }
        },
        computed: {
            isFolder: function () {
                return this.model.children &&
                    this.model.children.length
            }
        },
        methods: {
            toggle: function () {
                if (this.isFolder) {
                    this.open = !this.open
                }
            },
            edit : function(model) {
                console.log('edit',model);
            }
        }
    })

    var app = new Vue({
        el: '#app',
        data: {
            treeData: {},
            loading : true
        }
    })  

    $(function(){
        $.ajax({
            url: '/Admin/CategoryManagement/Get',
            success: function(result) {
                let tree = {};
                if(result[0]) {
                    tree = {
                        text : result[0].text,
                        id : result[0].id,
                        canInsert : result[0].canInsert,
                        children : result[0].children
                    }
                }
                app.treeData = tree;
            }
        })
    }) 
</script>
